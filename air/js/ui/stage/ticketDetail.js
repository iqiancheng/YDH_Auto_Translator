(new Gallery).addStage("ticketDetail",{header:{prevStage:"monitorBox",backWhole:!1,title:"抢飞机票"},temp:!0,init:function(){$("#buyItFromTicketDetail").click(function(){var n=$(this).attr("_link");Statistics.trigger(16,encodeURIComponent(n),(new Gallery).getCurrentStage());chrome.tabs.create({url:n})});$("#stopMonitor").click(function(){Statistics.trigger(15,(new Gallery).getCurrentStage());(new Gallery).backTo("monitorBox",!1,$(this).attr("_flightId"))})},prepare:function(n){var i=(new FlightMonitorBox).get(n),t=i.flight;Filler.fill($(".ticketDetailBox,.ticketFaxInfo,.buyItBtn",$(".ticketDetail")),{query:t.query,ticket:t.getData().main},{ticket:{date:function(n){return Util.date.formatToShort(Util.date.parse(n.ticket.date))},price:function(n){return"￥"+n.ticket.price+".00"},discount:function(n){return parseInt(n.ticket.discount,10)/10+"折"},zhundian:function(n){return n.ticket.zhundian?n.ticket.zhundian:"-"}},url:function(n){return n.ticket.url+"?"+n.ticket.date+config.urls.kuxunSuffix},flightTime:function(n){var t=n.ticket.launchtime.split(":"),i=n.ticket.landtime.split(":"),r=((i[0]-t[0])*60+(i[1]-t[1])+1440)%1440,u=Math.floor(r/60),f=r%60;return(u!==0?u+"小时":"")+(f!==0?f+"分":"")},ticketTrendExpression:function(n,t){parseInt(n.ticket.price,10)===parseInt(i.lastShowedPrice,10)?t.hide():parseInt(n.ticket.price,10)>parseInt(i.lastShowedPrice,10)?t.addClass("riseTrend").removeClass("fallTrend").show():parseInt(n.ticket.price,10)<parseInt(i.lastShowedPrice,10)&&t.addClass("fallTrend").removeClass("riseTrend").show()}});WeatherRetriever.fill($(".ticketDetail .fromGroup"),t.getData().main.date);WeatherRetriever.fill($(".ticketDetail .toGroup"),t.getData().main.date);$("#stopMonitor").attr("_flightId",t.getId());i.lastShowedPrice=parseInt(t.getData().main.price,10);(new FlightMonitorBox).persistenceOne(n)}})