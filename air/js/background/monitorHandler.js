chrome.extension.onRequest.addListener(function(n,t,i){switch(n.type){case"addMonitor":i(handleAddMonitor(n));break;case"removeMonitor":i(handleRemoveMonitor(n));break;case"updateErrorStatus":i(handleUpdateErrorStatus(n));break;case"receiveBargain":(new TimerManager).getTimer("bargain").start();break;case"refuseBargain":(new TimerManager).getTimer("bargain").halt()}});chrome.extension.onConnect.addListener(function(n){switch(n.name){case"retryMonitor":n.onMessage.addListener(function(t){(new FlightMonitorBox).get(t.flightId).flight.getData(config.monitor.retryTimes,!0,function(){delete(new FlightMonitorBox).get(t.flightId).error;(new FlightMonitorBox).persistenceOne(t.flightId);n.postMessage({flightId:t.flightId});handleUpdateErrorStatus()},function(i){(new FlightMonitorBox).get(t.flightId).error=i;(new FlightMonitorBox).persistenceOne(t.flightId);n.postMessage({flightId:t.flightId,error:i})})})}});var handleAddMonitor=function(n){var i,t,r;try{return i=FlightFactory.getFromId(n.flightId),t=n.monitor,i.getData(!0),t.time=Util.date.now(),t.lastTime=t.time,r=new FlightMonitorBox,r.add(i,t,n.lastShowedPrice).persistence(),chrome.browserAction.setBadgeText({text:r.getCount()+""}),(new TimerManager).getTimer("flip").start(),(new TimerManager).addTimer(getFlightTimer(n.flightId)),(new TimerManager).getTimer(n.flightId).start(),{status:0}}catch(u){throw u;}},handleRemoveMonitor=function(n){return(new FlightMonitorBox).remove(n.flightId).persistence(),(new FlightMonitorBox).getCount()<=0&&(chrome.browserAction.setBadgeText({text:""}),(new TimerManager).getTimer("flip").halt()),(new TimerManager).deleteTimer(n.flightId),handleUpdateErrorStatus(n)},handleUpdateErrorStatus=function(){var n=!1,t=(new FlightMonitorBox).getAll(),i;for(i in t)if(t[i].error!==undefined){n=!0;break}return n===!1,{status:n?1:0}}